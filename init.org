#+PROPERTY: header-args :comments yes :results silent

* Early Init é…ç½®
#+begin_src emacs-lisp :tangle early-init.el
;;; early-init.el --- Emacs pre-initialization config -*- lexical-binding: t -*-

;; å®šä¹‰æ­£å¸¸åƒåœ¾å›æ”¶é˜ˆå€¼
(defvar normal-gc-cons-threshold (* 20 1024 1024))

;; ä¼˜åŒ–åƒåœ¾å›æ”¶ï¼ŒåŠ å¿«å¯åŠ¨é€Ÿåº¦
(setq gc-cons-threshold most-positive-fixnum
      gc-cons-percentage 0.6)

;; ç¦ç”¨ package.el è‡ªåŠ¨åŠ è½½
(setq package-enable-at-startup nil)
(setq package-quickstart nil)

;; ç¦ç”¨èœå•æ ã€å·¥å…·æ ã€æ»šåŠ¨æ¡
(push '(menu-bar-lines . 0) default-frame-alist)
(push '(tool-bar-lines . 0) default-frame-alist)
(push '(vertical-scroll-bars) default-frame-alist)

(menu-bar-mode -1)
(tool-bar-mode -1)
(scroll-bar-mode -1)

;; ç¦ç”¨å¯åŠ¨ç”»é¢å’Œæ–‡ä»¶å¯¹è¯æ¡†
(setq inhibit-splash-screen t
      use-file-dialog nil)

;; ç¦æ­¢è‡ªåŠ¨ç¼©æ”¾çª—å£
(setq frame-inhibit-implied-resize t)

;; Emacs 28+ï¼šç¦æ­¢å»¶è¿Ÿç¼–è¯‘
(when (boundp 'comp-deferred-compilation)
  (setq comp-deferred-compilation nil))

;; å¯åŠ¨åæ¢å¤æ­£å¸¸åƒåœ¾å›æ”¶é˜ˆå€¼
(add-hook 'emacs-startup-hook
          (lambda () (setq gc-cons-threshold normal-gc-cons-threshold)))

(provide 'early-init)
;;; early-init.el ends here
#+end_src

* åŸºç¡€é…ç½®
#+begin_src emacs-lisp :tangle lisp/init-basic.el
;;; init-basic.el --- Basic configurations -*- lexical-binding: t -*-

;; åŸºç¡€è®¾ç½®
(setq inhibit-splash-screen t)
(if (fboundp 'tool-bar-mode) (tool-bar-mode -1))
(if (fboundp 'menu-bar-mode) (menu-bar-mode -1))
(if (fboundp 'scroll-bar-mode) (scroll-bar-mode -1))

;; ç¼–ç è®¾ç½®
(prefer-coding-system 'utf-8)
(set-terminal-coding-system 'utf-8)
(set-keyboard-coding-system 'utf-8)
(set-selection-coding-system 'utf-8)
(setq locale-coding-system 'utf-8)
(setq default-buffer-file-coding-system 'utf-8)

;; è®¾ç½® M-p ä¸º execute-extended-command
(global-set-key (kbd "M-p") 'execute-extended-command)

;; è‡ªåŠ¨æ›´æ–°æ–‡ä»¶
(setq auto-revert-interval 1)  ;; æ¯ç§’æ£€æŸ¥ä¸€æ¬¡
(setq auto-revert-check-vc-info t)  ;; æ£€æŸ¥ç‰ˆæœ¬æ§åˆ¶ä¿¡æ¯
(setq auto-revert-verbose nil)  ;; ä¸æ˜¾ç¤ºæç¤ºä¿¡æ¯
(setq auto-revert-use-notify t)  ;; ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿé€šçŸ¥
(setq auto-revert-stop-on-user-input nil)  ;; ç”¨æˆ·è¾“å…¥æ—¶ç»§ç»­æ›´æ–°
(setq auto-revert-remote-files t)  ;; æ”¯æŒè¿œç¨‹æ–‡ä»¶
(global-auto-revert-mode 1)  ;; å…¨å±€å¯ç”¨

;; ä¼˜åŒ–æ–‡ä»¶ç›‘æ§
(when (and (fboundp 'file-notify-add-watch)
           (executable-find "inotifywait"))
  (setq auto-revert-notify-exclude-dir-regexp
        (concat "\\`" (regexp-opt '("/tmp" "/var/tmp" "/dev" "/sys" "/proc")) "\\'")))

(provide 'init-basic)
#+end_src

* è¯­è¨€é…ç½®
#+begin_src emacs-lisp :tangle lisp/init-lang.el
;;; init-lang.el --- Language specific configurations -*- lexical-binding: t -*-

;; General LSP settings (for lsp-mode, often a dependency)
(use-package lsp-mode
  :ensure nil ; It's likely a dependency, we're just configuring it
  :commands (lsp lsp-deferred) ; Ensures it's loaded when LSP commands are used
  :config
  (setq lsp-log-io nil)      ;; Disable LSP I/O logging for performance
  (setq lsp-idle-delay 0.6)  ;; Slightly increase idle delay (default 0.5s)
  (setq lsp-enable-file-watchers nil) ;; Disable file watchers for performance
  (setq lsp-enable-snippet nil) ;; Disable lsp-mode's snippets if you use others or none
  
  ;; Server installation settings
  (setq lsp-auto-configure t)  ;; Auto-configure LSP features
  (setq lsp-auto-guess-root t) ;; Auto-detect project root
  (setq lsp-enable-indentation t) ;; Enable LSP-based indentation
  (setq lsp-enable-on-type-formatting t) ;; Enable formatting on type
  (setq lsp-enable-symbol-highlighting t) ;; Enable symbol highlighting
  (setq lsp-enable-text-document-color t) ;; Enable color support
  (setq lsp-enable-semantic-highlighting t) ;; Enable semantic highlighting
  
  ;; Server installation preferences
  (setq lsp-install-server-command '("npm" "install" "-g")) ;; Use npm for server installation
  (setq lsp-server-install-dir (expand-file-name "lsp-servers" user-emacs-directory)) ;; Custom installation directory
  
  ;; Diagnostic settings
  (setq lsp-diagnostic-package :none) ;; Use built-in diagnostics
  (setq lsp-diagnostic-clean-after-change t) ;; Clean diagnostics after changes
  (setq lsp-diagnostic-disabled-modes '(org-mode markdown-mode)) ;; Disable diagnostics in certain modes
  )

;; é€šç”¨ç¼–ç¨‹é…ç½®
(use-package editorconfig
  :ensure t
  :diminish
  :hook (prog-mode . editorconfig-mode))

(use-package format-all
  :ensure t
  :diminish
  :hook ((prog-mode . format-all-mode)
         (before-save . format-all-buffer))
  :config
  (setq format-all-formatters
        '(("Python" black))))

(use-package flycheck
  :ensure t
  :diminish
  :hook (prog-mode . flycheck-mode)
  :config
  (setq flycheck-check-syntax-automatically '(save mode-enabled)
        flycheck-idle-change-delay 0.5)
  (custom-set-faces
   '(flycheck-error ((t (:underline (:style wave :color "#ff5555")))))
   '(flycheck-warning ((t (:underline (:style wave :color "#ffb86c")))))
   '(flycheck-info ((t (:underline (:style wave :color "#8be9fd")))))))

(use-package company
  :ensure t
  :diminish
  :hook (prog-mode . company-mode)
  :config
  (setq company-idle-delay 0.1
        company-minimum-prefix-length 2
        company-tooltip-limit 10
        company-dabbrev-downcase nil
        company-dabbrev-ignore-case t)
  (setq company-backends
        '((company-capf
           company-dabbrev-code
           company-keywords
           company-files)
          (company-dabbrev))))

;; åŠ è½½è¯­è¨€ç‰¹å®šé…ç½®
(require 'init-python)

(provide 'init-lang)
#+end_src

* Python é…ç½®
#+begin_src emacs-lisp :tangle lisp/init-python.el
;;; init-python.el --- Python specific configurations -*- lexical-binding: t -*-

(use-package python
  :ensure t
  :defer t
  :mode ("\\.py\\'" . python-mode)
  :interpreter ("python" . python-mode)
  :config
  (setq python-indent-offset 4)
  
  ;; ä»£ç æ ¼å¼åŒ–
  (use-package blacken
    :ensure t
    :diminish
    :hook (python-mode . blacken-mode)
    :config 
    (setq blacken-line-length 88
          blacken-allow-py36 t
          blacken-skip-string-normalization t))

  ;; LSP é›†æˆ
  (use-package lsp-pyright
    :ensure t
    :after python
    :hook (python-mode . (lambda () (require 'lsp-pyright) (lsp-deferred)))
    :config
    (setq lsp-pyright-use-library-code-for-types t
          lsp-pyright-diagnostic-mode "workspace"
          lsp-pyright-typechecking-mode "basic"
          lsp-pyright-auto-import-completions t
          lsp-pyright-auto-search-paths t)))

(provide 'init-python)
#+end_src

* åŒ…ç®¡ç†é…ç½®
#+begin_src emacs-lisp :tangle lisp/init-package.el
  (setq use-package-compute-statistics t) ;; Enable timing for M-x use-package-report

  (require 'package)

  (setq package-archives
        '(("gnu"   . "https://mirrors.ustc.edu.cn/elpa/gnu/")
          ("melpa" . "https://mirrors.ustc.edu.cn/elpa/melpa/")
          ("org"   . "https://mirrors.ustc.edu.cn/elpa/emacs-policy/elpa-org/")))

  (package-initialize)

  ;; Ensure package contents are loaded
  (unless package-archive-contents
    (package-refresh-contents))

  ;; Ensure `use-package`, `evil`, `markdown-mode`, `vertico`, and `orderless` are installed
  (dolist (pkg '(use-package evil markdown-mode vertico orderless))
    (unless (package-installed-p pkg)
      (package-install pkg)))

  (provide 'init-package)
#+end_src

* Evil é…ç½®
#+begin_src emacs-lisp :tangle lisp/init-evil.el
  (require 'evil)
  (evil-mode 1)

  ;; æ£€æŸ¥ fcitx5-remote æ˜¯å¦å¯ç”¨
  (defun check-fcitx5-remote ()
    (executable-find "fcitx5-remote"))

  ;; åˆ‡æ¢åˆ°è‹±æ–‡è¾“å…¥æ³•
  (defun switch-to-english-input ()
    (when (check-fcitx5-remote)
      (call-process "fcitx5-remote" nil nil nil "-c")))

  ;; åœ¨è¿›å…¥æ™®é€šæ¨¡å¼æ—¶åˆ‡æ¢åˆ°è‹±æ–‡è¾“å…¥æ³•
  (add-hook 'evil-normal-state-entry-hook 'switch-to-english-input)

  ;; è‡ªå®šä¹‰é”®ä½æ˜ å°„
  (evil-define-key 'normal 'global
    "H" 'evil-first-non-blank  ;; ç§»åŠ¨åˆ°è¡Œé¦–éç©ºç™½å­—ç¬¦
    "L" 'evil-end-of-line)     ;; ç§»åŠ¨åˆ°è¡Œå°¾

  (evil-define-key 'visual 'global
    "H" 'evil-first-non-blank  ;; ç§»åŠ¨åˆ°è¡Œé¦–éç©ºç™½å­—ç¬¦
    "L" 'evil-end-of-line)     ;; ç§»åŠ¨åˆ°è¡Œå°¾

  ;; å¯é€‰ï¼šæ·»åŠ æ›´å¤šå¸¸ç”¨é”®ä½æ˜ å°„
  (evil-define-key 'normal 'global
    "gh" 'evil-window-top      ;; ç§»åŠ¨åˆ°çª—å£é¡¶éƒ¨
    "gl" 'evil-window-bottom   ;; ç§»åŠ¨åˆ°çª—å£åº•éƒ¨
    "gj" 'evil-next-line       ;; å‘ä¸‹ç§»åŠ¨ä¸€è¡Œ
    "gk" 'evil-previous-line)  ;; å‘ä¸Šç§»åŠ¨ä¸€è¡Œ

  (provide 'init-evil)
#+end_src

* UI é…ç½®
#+begin_src emacs-lisp :tangle lisp/init-ui.el
  ;; Enable pixel scroll
  (pixel-scroll-precision-mode 1)
  
  ;; Enable smooth scrolling
  (setq pixel-scroll-precision-interpolate-page t)
  
  ;; Use pixel scroll for all scrolling commands
  (defalias 'scroll-up-command 'pixel-scroll-interpolate-down)
  (defalias 'scroll-down-command 'pixel-scroll-interpolate-up)
  
  ;; Additional scroll settings for better experience
  (setq scroll-conservatively 101)  ;; Don't recenter point
  (setq scroll-margin 0)            ;; No margin when scrolling
  (setq scroll-preserve-screen-position t)  ;; Keep cursor position relative to screen
  (setq mouse-wheel-scroll-amount '(1 ((shift) . 1)))  ;; Fine-tune mouse wheel scrolling
  (setq mouse-wheel-progressive-speed nil)  ;; Disable progressive speed

  ;; é…ç½®è¡Œå·æ˜¾ç¤º
  (setq display-line-numbers-type 'relative)  ;; è®¾ç½®ç›¸å¯¹è¡Œå·
  (global-display-line-numbers-mode 1)        ;; å…¨å±€å¯ç”¨è¡Œå·

  ;; åœ¨ç‰¹å®šæ¨¡å¼ä¸‹ç¦ç”¨è¡Œå·
  (dolist (mode '(org-mode markdown-mode gfm-mode dashboard-mode vterm-mode eshell-mode shell-mode term-mode))
    (add-hook (intern (format "%s-hook" mode)) 
              (lambda () (display-line-numbers-mode 0))))

  ;; é…ç½® doom-modeline
(use-package doom-modeline
  :ensure t
  :init
  (doom-modeline-mode 1)
  :custom
  (doom-modeline-height 25)                ;; è®¾ç½®é«˜åº¦
  (doom-modeline-bar-width 3)              ;; è®¾ç½®æŒ‡ç¤ºæ¡å®½åº¦
  (doom-modeline-icon t)                   ;; æ˜¾ç¤ºå›¾æ ‡
  (doom-modeline-major-mode-icon t)        ;; æ˜¾ç¤ºä¸»æ¨¡å¼å›¾æ ‡
  (doom-modeline-buffer-encoding t)        ;; æ˜¾ç¤ºç¼–ç 
  (doom-modeline-indent-info t)            ;; æ˜¾ç¤ºç¼©è¿›ä¿¡æ¯
  (doom-modeline-lsp t)                    ;; æ˜¾ç¤º LSP çŠ¶æ€
  (doom-modeline-time t)                   ;; æ˜¾ç¤ºæ—¶é—´
  (doom-modeline-time-24hr t))             ;; ä½¿ç”¨24å°æ—¶åˆ¶

  (provide 'init-ui)
#+end_src

* å­—ä½“é…ç½®
#+begin_src emacs-lisp :tangle lisp/init-font.el
(setq inhibit-compacting-font-caches t) ;; Improve performance with icons/diverse fonts

;; ç¡®ä¿ all-the-icons åŒ…å·²å®‰è£…å¹¶åŠ è½½
(use-package all-the-icons
  :ensure t
  :if (display-graphic-p)
  :config
  (setq all-the-icons-scale-factor 1.0)
  (setq all-the-icons-default-adjust 0))

;; ç³»ç»Ÿç‰¹å®šçš„å­—ä½“åç§°
(defvar my/font-names
  '((darwin . ("MapleMonoNL-NF-CN" "SF Mono" "Menlo" "Monaco"))
    (gnu/linux . ("MapleMonoNL-NF-CN" "DejaVu Sans Mono" "Monospace"))
    (windows-nt . ("MapleMonoNL-NF-CN" "Consolas" "Monospace")))
  "ç³»ç»Ÿç‰¹å®šçš„å­—ä½“åç§°åˆ—è¡¨")

;; è®¾ç½®é»˜è®¤å­—ä½“æ—å’Œå¤§å°
(defun my/set-font (font-family)
  "å®‰å…¨åœ°è®¾ç½®å­—ä½“ï¼Œå¦‚æœå­—ä½“ä¸å¯ç”¨åˆ™è¿”å› nil"
  (when (member font-family (font-family-list))
    (set-face-attribute 'default nil
                      :font font-family
                      :height 130)
    (set-face-attribute 'fixed-pitch nil
                      :font font-family
                      :height (face-attribute 'default :height))
    (set-fontset-font t 'han (font-spec :family font-family
                                      :height (face-attribute 'default :height)))
    (set-face-attribute 'fixed-pitch-serif nil
                      :font font-family
                      :height (face-attribute 'default :height))
    t))

;; è·å–å½“å‰ç³»ç»Ÿçš„å­—ä½“åˆ—è¡¨
(defun my/get-system-fonts ()
  (or (cdr (assoc system-type my/font-names))
      '("Monospace")))

;; æŒ‰ä¼˜å…ˆçº§å°è¯•è®¾ç½®å­—ä½“
(unless (cl-some #'my/set-font (my/get-system-fonts))
  (message "Warning: No suitable font found"))

(provide 'init-font)
#+end_src

* Markdown é…ç½®
#+begin_src emacs-lisp :tangle lisp/init-markdown.el
;;; init-markdown.el --- Initialize markdown configurations -*- lexical-binding: t -*-

(use-package markdown-mode
  :ensure t
  :defer t  ;; å»¶è¿ŸåŠ è½½
  :mode (("\\.md\\'" . gfm-mode)
         ("\\.markdown\\'" . gfm-mode))
  :init
  (setq markdown-command "multimarkdown")
  :custom
  (markdown-fontify-code-blocks-natively t)
  (markdown-header-scaling t)
  (markdown-hide-urls t)
  (markdown-indent-on-enter 'indent-and-new-item)
  (markdown-list-indent-width 2))

;; ä½¿ç”¨ org-modern é£æ ¼çš„æ ‡é¢˜æ ·å¼
(custom-set-faces
 '(markdown-header-face-1 ((t (:inherit org-level-1 :height 1.5 :weight bold))))
 '(markdown-header-face-2 ((t (:inherit org-level-2 :height 1.25 :weight bold))))
 '(markdown-header-face-3 ((t (:inherit org-level-3 :height 1.1 :weight bold))))
 '(markdown-header-face-4 ((t (:inherit org-level-4 :height 1.0 :weight bold))))
 '(markdown-header-face-5 ((t (:inherit org-level-5 :height 1.0 :weight bold))))
 '(markdown-header-face-6 ((t (:inherit org-level-6 :height 1.0 :weight bold)))))

;; ä½¿ç”¨ org-modern é£æ ¼çš„åˆ—è¡¨æ ·å¼
(use-package org-modern
  :ensure t
  :config
  (setq org-modern-list '((?- . "â€¢") (?+ . "â—¦") (?* . "â–¹"))))

;; ä½¿ç”¨ prettify-symbols-mode æ›¿æ¢ç‰¹æ®Šæ ‡è®°
(defun my/markdown-prettify-symbols ()
  "Enable prettify symbols in Markdown mode.
Replaces common Markdown constructs with Unicode symbols for better readability."
  (setq prettify-symbols-alist
        '(("```" . "ğŸ–¥")
          ("`" . "âŒ¨")
          ("*" . "â€¢")
          ("**" . "âœ§")
          ("***" . "âœ¦")
          ("_" . "â–±")
          ("__" . "â–°")
          ("~~" . "â‰ˆ")))
  (prettify-symbols-mode 1))

(add-hook 'markdown-mode-hook 'my/markdown-prettify-symbols)

;; ä½¿ç”¨ olivetti å±…ä¸­æ˜¾ç¤ºå†…å®¹
(use-package olivetti
  :ensure t
  :hook (markdown-mode . olivetti-mode)
  :config
  (setq olivetti-body-width 0.618))

;; å¯ç”¨è‡ªåŠ¨æ¢è¡Œ
(add-hook 'markdown-mode-hook 'visual-line-mode)

(provide 'init-markdown)
#+end_src

* Org é…ç½®
#+begin_src emacs-lisp :tangle lisp/init-org.el
  (require 'org-tempo)

  ;; é…ç½® Org table å­—ä½“
  (set-face-attribute 'org-table nil
                     :font (face-attribute 'default :font)
                     :height (face-attribute 'default :height))

  ;; Org mode è¡¨æ ¼å¯¹é½è®¾ç½®
  (setq org-table-align-indent t)
  (setq org-table-align-char ?\s)

  ;; ç¡®ä¿ Org è¡¨æ ¼ä¸­çš„å­—ä½“å¤§å°æ­£ç¡®
  (add-hook 'org-mode-hook
            (lambda ()
              (set-face-attribute 'org-table nil
                                :font (face-attribute 'default :font)
                                :height (face-attribute 'default :height))))
                                
  ;; è®¾ç½®æ ‡é¢˜æ ·å¼
  (custom-set-faces
   '(org-document-title ((t (:height 1.75 :weight bold))))
   '(org-level-1 ((t (:height 1.5 :weight bold))))
   '(org-level-2 ((t (:height 1.25 :weight bold))))
   '(org-level-3 ((t (:height 1.1 :weight bold))))
   '(org-level-4 ((t (:height 1.0 :weight bold))))
   '(org-level-5 ((t (:height 1.0 :weight bold))))
   '(org-level-6 ((t (:height 1.0 :weight bold))))
   '(org-level-7 ((t (:height 1.0 :weight bold))))
   '(org-level-8 ((t (:height 1.0 :weight bold)))))

  ;; ä½¿ç”¨ org-modern ç¾åŒ–ç•Œé¢
  (use-package org-modern
    :ensure t
    :hook (org-mode . org-modern-mode)
    :config
    (setq org-modern-star '("â˜…" "â˜†" "â—†" "â—‡" "â–¶" "â–·" "âœ¿" "â€"))
    (setq org-modern-list '((?- . "â€¢") (?+ . "â—¦") (?* . "â–¹")))
    (setq org-modern-table t)
    (setq org-modern-block-name
          '((t . t)
            ("src" "Â»" "Â«")
            ("example" "Â»â€“" "â€“Â«")
            ("quote" "â" "â"))))

  ;; ä½¿ç”¨ org-appear æ˜¾ç¤ºå¼ºè°ƒæ ‡è®°
  (use-package org-appear
    :ensure t
    :hook (org-mode . org-appear-mode)
    :config
    (setq org-appear-autolinks t
          org-appear-autosubmarkers t
          org-appear-autoentities t
          org-appear-autokeywords t
          org-appear-inside-latex t))

  ;; ä½¿ç”¨ prettify-symbols-mode æ›¿æ¢ç‰¹æ®Šæ ‡è®°
  (defun my/org-prettify-symbols ()
    "Enable prettify symbols in Org mode.
Replaces common Org mode constructs with Unicode symbols for better readability."
    (setq prettify-symbols-alist
          '(("#+TITLE:" . "ğŸ“˜")
            ("#+AUTHOR:" . "ğŸ‘¤")
            ("#+DATE:" . "ğŸ“…")
            ("#+EMAIL:" . "ğŸ“§")
            ("#+OPTIONS:" . "âš™")
            ("#+BEGIN_SRC" . "ğŸ–¥")
            ("#+END_SRC" . "ğŸ–¥")
            ("#+BEGIN_QUOTE" . "â")
            ("#+END_QUOTE" . "â")
            ("#+RESULTS:" . "ğŸ“Š")))
    (prettify-symbols-mode 1))
  (add-hook 'org-mode-hook 'my/org-prettify-symbols)

  ;; ä½¿ç”¨ olivetti å±…ä¸­æ˜¾ç¤ºå†…å®¹
  (use-package olivetti
    :ensure t
    :hook (org-mode . olivetti-mode)
    :config
    (setq olivetti-body-width 0.618))

  ;; è®¾ç½®å…¶ä»– Org-mode é€‰é¡¹
  (setq org-hide-emphasis-markers t
        org-startup-indented t
        org-ellipsis " â–¼ "
        org-pretty-entities t
        org-fontify-whole-heading-line t
        org-fontify-done-headline t
        org-fontify-quote-and-verse-blocks t
        org-hide-leading-stars t
        org-startup-with-inline-images t
        org-image-actual-width '(300)
        org-adapt-indentation nil)

  ;; ç¾åŒ–å†…è”ä»£ç 
  (defface org-inline-code-face
    '((t :inherit (shadow fixed-pitch)
         :foreground "#88c0d0"
         :background "#2e3440"
         :box (:line-width -1 :color "#4c566a")
         :height 0.9))
    "Face for inline code in Org mode.")

  (defun my/org-prettify-inline-code ()
    "Make inline code more visible in Org mode.
Adds a subtle background and border to inline code blocks."
    (font-lock-add-keywords
     nil
     '(("\\(\\\\begin{[a-zA-Z0-9]+}\\)" 1 'org-block-begin-line prepend)
       ("\\(\\\\end{[a-zA-Z0-9]+}\\)" 1 'org-block-end-line prepend)
       ("\\(~\\)\\([^~]+\\)\\(~\\)" (0 'org-inline-code-face t))
       ("\\(=\\)\\([^=]+\\)\\(=\\)" (0 'org-inline-code-face t)))))  ;; æ·»åŠ ç­‰å·æ ‡è®°çš„ä»£ç 

  (add-hook 'org-mode-hook 'my/org-prettify-inline-code)

  (provide 'init-org)
#+end_src

* ä¸»é¢˜é…ç½®
#+begin_src emacs-lisp :tangle lisp/init-theme.el
  ;; å®‰è£…doom-themeså’Œæ‰€æœ‰å›¾æ ‡
  (use-package doom-themes
    :ensure t
    :config
    ;; å…¨å±€è®¾ç½®
    (setq doom-themes-enable-bold t    ; å¦‚æœnilï¼Œç²—ä½“å°†è¢«ç¦ç”¨
          doom-themes-enable-italic t) ; å¦‚æœnilï¼Œæ–œä½“å°†è¢«ç¦ç”¨
    
    ;; åŠ è½½Nordä¸»é¢˜ï¼ˆå†·è‰²ç³»ï¼‰
    (load-theme 'doom-nord t)
    
    ;; å¯ç”¨é—ªäº®çš„ä»£ç å—
    (doom-themes-org-config)
    
    ;; æ”¹è¿›ä»£ç å—è¾¹æ¡†å’ŒèƒŒæ™¯
    (custom-set-faces
     '(org-block-begin-line ((t (:foreground "#5B6268" :background "#2d333b" :extend t :italic t :height 0.9))))
     '(org-block ((t (:background "#21242b" :extend t))))
     '(org-block-end-line ((t (:foreground "#5B6268" :background "#2d333b" :extend t :italic t :height 0.9))))))
  
  ;; ä»£ç å—ç¾åŒ–è®¾ç½®
  (use-package highlight-indent-guides
    :ensure t
    :hook (prog-mode . highlight-indent-guides-mode)
    :config
    (setq highlight-indent-guides-method 'character
          highlight-indent-guides-responsive 'top
          highlight-indent-guides-delay 0
          highlight-indent-guides-auto-character-face-perc 30))
  
  ;; å½©è™¹åˆ†éš”ç¬¦
  (use-package rainbow-delimiters
    :ensure t
    :hook (prog-mode . rainbow-delimiters-mode))
  
  ;; ä»£ç å—ç¾åŒ–
  (use-package org-bullets
    :ensure t
    :hook (org-mode . org-bullets-mode)
    :custom
    (org-bullets-bullet-list '("â—‰" "â—‹" "â—" "â—‹" "â—" "â—‹" "â—")))
  
  ;; ä¸ºorg-modernå’Œolivettiæ¨¡å¼æä¾›æ›´å¥½çš„ä¸»é¢˜é›†æˆ
  (with-eval-after-load 'org-modern
    (custom-set-faces
     '(org-modern-label ((t (:height 0.9 :box (:line-width -1 :color "#81a1c1") :foreground "#81a1c1" :background "#2e3440"))))
     '(org-modern-tag ((t (:foreground "#5e81ac" :background "#2e3440" :box (:line-width -1 :color "#4c566a")))))))
  
  ;; æä¾›è‡ªå®šä¹‰çš„modelineé…ç½®
  (with-eval-after-load 'doom-modeline
    (custom-set-faces
     '(mode-line ((t (:background "#3b4252" :foreground "#eceff4"))))
     '(mode-line-inactive ((t (:background "#2e3440" :foreground "#4c566a"))))))
  
  ;; æºä»£ç å—è¯­æ³•é«˜äº®
  (setq org-src-fontify-natively t
        org-src-tab-acts-natively t
        org-confirm-babel-evaluate nil
        org-edit-src-content-indentation 0)
        
  ;; ç¾åŒ–å†…è”ä»£ç 
  (defface org-inline-code-face
    '((t :inherit (shadow fixed-pitch)
         :foreground "#88c0d0"
         :background "#2e3440"
         :box (:line-width -1 :color "#4c566a")))
    "Face for inline code in Org mode.")
  
  (defun my/org-prettify-inline-code ()
    "Make inline code more visible in Org mode."
    (font-lock-add-keywords
     nil
     '(("\\(\\\\begin{[a-zA-Z0-9]+}\\)" 1 'org-block-begin-line prepend)
       ("\\(\\\\end{[a-zA-Z0-9]+}\\)" 1 'org-block-end-line prepend)
       ("\\(~\\)\\([^~]+\\)\\(~\\)" (0 'org-inline-code-face t)))))
  
  (add-hook 'org-mode-hook 'my/org-prettify-inline-code)
  
  (provide 'init-theme)
#+end_src

* å¯åŠ¨é…ç½®
#+begin_src emacs-lisp :tangle lisp/init-startup.el
;;; init-startup.el --- Initialize startup configurations -*- lexical-binding: t -*-

;; â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
;; â”‚ setting â”‚
;; â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

;; è®¾ç½® logo
(defcustom centaur-logo (expand-file-name
                        (if (display-graphic-p) "~/.emacs.d/dashboard/eva.png" "~/.emacs.d/dashboard/banner.txt")
                        user-emacs-directory)
  "Set Centaur logo. nil means official logo."
  :group 'centaur
  :type 'string)

;; è®¾ç½®å¯åŠ¨ç¼“å†²åŒº
(defun my/startup-buffer ()
  "Return the buffer to show at startup."
  (let ((file (car (cdr command-line-args))))  ;; è·å–ç¬¬ä¸€ä¸ªéé€‰é¡¹å‚æ•°
    (if (and file (file-exists-p file))
        (find-file file)
      (get-buffer-create "*dashboard*"))))

;; è®¾ç½®å¯åŠ¨è¡Œä¸º
(setq initial-buffer-choice #'my/startup-buffer)

;; å¤„ç†å‘½ä»¤è¡Œå‚æ•°
(add-hook 'after-init-hook
          (lambda ()
            (when (and (not (daemonp))
                      (not (get-buffer "*dashboard*"))
                      (not (cdr command-line-args)))  ;; åªæœ‰åœ¨æ²¡æœ‰å‘½ä»¤è¡Œå‚æ•°æ—¶æ‰æ˜¾ç¤º dashboard
              (dashboard-refresh-buffer))))

(provide 'init-startup)
#+end_src

* Dashboard é…ç½®
#+begin_src emacs-lisp :tangle lisp/init-dashboard.el
;;; init-dashboard.el --- Initialize dashboard configurations -*- lexical-binding: t -*-

;; ç¡®ä¿ all-the-icons å·²å®‰è£…å¹¶æ­£ç¡®åŠ è½½
(use-package all-the-icons
  :ensure t
  :if (display-graphic-p))

(use-package dashboard
  :ensure t
  :init
  ;; åŸºæœ¬è®¾ç½®
  (setq dashboard-startup-banner (or centaur-logo 'official))  ;; ä¿ç•™è‡ªå®šä¹‰ logo
  (setq dashboard-banner-logo-title "Welcome to Emacs")  ;; æ¬¢è¿ä¿¡æ¯
  
  ;; å…³é”®å±…ä¸­è®¾ç½®
  (setq dashboard-center-content t)     ;; æ°´å¹³å±…ä¸­æ˜¾ç¤ºå†…å®¹
  (setq dashboard-vertically-center-content t)  ;; å‚ç›´å±…ä¸­å†…å®¹
  (setq dashboard-items-default-length 5)  ;; æ¯ä¸ªéƒ¨åˆ†æ˜¾ç¤ºçš„æ¡ç›®æ•°
  
  ;; å†…å®¹æ˜¾ç¤ºè®¾ç½®
  (setq dashboard-set-heading-icons t)  ;; æ˜¾ç¤ºæ ‡é¢˜å›¾æ ‡
  (setq dashboard-set-file-icons t)     ;; æ˜¾ç¤ºæ–‡ä»¶å›¾æ ‡
  (setq dashboard-image-banner-max-width 300)  ;; å›¾ç‰‡æœ€å¤§å®½åº¦
  (setq dashboard-image-banner-max-height 300) ;; å›¾ç‰‡æœ€å¤§é«˜åº¦
  (setq dashboard-items '((recents  . 5)    ;; æœ€è¿‘æ–‡ä»¶æ•°é‡
                          ;; (projects . 5)  ;; é¡¹ç›®æ•°é‡ - å·²ç§»é™¤å› ä¸ºéœ€è¦projectile
                          (bookmarks . 5)   ;; ä¹¦ç­¾æ•°é‡
                          (agenda . 5)      ;; æ—¥ç¨‹æ•°é‡
                          (registers . 5))) ;; å¯„å­˜å™¨æ•°é‡
  
  ;; æ ·å¼è®¾ç½®
  (setq dashboard-set-navigator nil)      ;; ä¸æ˜¾ç¤ºå¯¼èˆªå™¨
  (setq dashboard-set-init-info t)      ;; æ˜¾ç¤ºåˆå§‹åŒ–ä¿¡æ¯
  (setq dashboard-set-footer t)         ;; æ˜¾ç¤ºé¡µè„š
  (setq dashboard-footer-messages '("Welcome to Emacs!"))  ;; è‡ªå®šä¹‰é¡µè„šæ¶ˆæ¯
  
  ;; æœ€å…³é”®çš„æ ‡é¢˜æ ¼å¼è®¾ç½®
  (setq dashboard-item-names '(("Recent Files:" . "Recent Files:")  ;; ä¿æŒè‹±æ–‡ä¸€è‡´æ€§
                               ("Bookmarks:" . "Bookmarks:")
                               ("Agenda for today:" . "Agenda for today:")
                               ("Registers:" . "Registers:")))
  :config
  ;; å›¾æ ‡è®¾ç½® - æ”¾åœ¨:configéƒ¨åˆ†ç¡®ä¿all-the-iconså·²åŠ è½½
  (when (display-graphic-p)
    (setq dashboard-footer-icon (all-the-icons-octicon "dashboard"
                                                     :height 1.1
                                                     :v-adjust -0.05
                                                     :face 'font-lock-keyword-face)))
  (dashboard-setup-startup-hook))

;; ä¼˜åŒ– dashboard æ ·å¼å’Œæ€§èƒ½
(with-eval-after-load 'dashboard
  ;; åŸºæœ¬ä¼˜åŒ–è®¾ç½®
  (setq dashboard-set-heading-icons t)
  (setq dashboard-set-file-icons t)
  (setq dashboard-set-navigator nil)
  
  ;; ç¼“å­˜è®¾ç½®
  (setq dashboard-cache-file (expand-file-name "dashboard-cache.el" user-emacs-directory))
  (setq dashboard-cache-prefetch t))

(provide 'init-dashboard)
#+end_src

* è¡¥å…¨ç³»ç»Ÿé…ç½®
#+begin_src emacs-lisp :tangle lisp/init-completion.el
;;; init-completion.el --- Initialize completion configurations -*- lexical-binding: t -*-

;; å¯ç”¨ vertico
(use-package vertico
  :ensure t
  :init
  (vertico-mode)
  :custom
  (vertico-cycle t)  ;; å¾ªç¯é€‰æ‹©
  (vertico-resize t) ;; è‡ªåŠ¨è°ƒæ•´å¤§å°
  (vertico-count 10) ;; æ˜¾ç¤º10ä¸ªå€™é€‰é¡¹
  (vertico-scroll-margin 0)) ;; æ»šåŠ¨è¾¹è·

;; å¯ç”¨ orderless è¡¥å…¨é£æ ¼
(use-package orderless
  :ensure t
  :custom
  (completion-styles '(orderless))
  (completion-category-defaults nil)
  (completion-category-overrides '((file (styles orderless)))))

;; é…ç½® M-x å‘½ä»¤è¡¥å…¨
(defun my/vertico-command-completion ()
  "Configure command completion for M-x."
  (setq-local vertico-sort-function nil)  ;; ç¦ç”¨æ’åº
  (setq-local vertico-group-format #'vertico-group-format)  ;; å¯ç”¨åˆ†ç»„
  (setq-local vertico-count-format #'vertico-count-format))  ;; å¯ç”¨è®¡æ•°

(add-hook 'vertico-mode-hook #'my/vertico-command-completion)

;; é…ç½® M-x å‘½ä»¤å†å²
(use-package savehist
  :ensure t
  :init (savehist-mode 1)
  :custom
  (savehist-additional-variables '(extended-command-history file-name-history)))

;; é…ç½®å‘½ä»¤å»ºè®®
(use-package marginalia
  :ensure t
  :init
  (marginalia-mode)
  :custom
  (marginalia-align 'right)
  (marginalia-annotators '(marginalia-annotators-heavy)))

;; é…ç½®å‘½ä»¤æç¤º
(use-package consult
  :ensure t
  :custom
  (consult-preview-key nil)  ;; ç¦ç”¨é¢„è§ˆ
  (consult-narrow-key "<")   ;; è®¾ç½®çª„åŒ–é”®
  (consult-widen-key ">"))   ;; è®¾ç½®æ‰©å±•é”®

;; æ–‡ä»¶è¡¥å…¨å¢å¼º
(use-package all-the-icons
  :ensure t
  :if (display-graphic-p))

(use-package all-the-icons-completion
  :ensure t
  :after (marginalia all-the-icons)
  :hook (marginalia-mode . all-the-icons-completion-marginalia-setup)
  :init
  (all-the-icons-completion-mode))

;; æ–‡ä»¶è¡¥å…¨å†å²è®°å½•
(use-package recentf
  :ensure t
  :init
  (recentf-mode)
  :custom
  (recentf-max-saved-items 100)
  (recentf-exclude '("/tmp/" "/var/tmp/" ".git/" ".cache/"))
  (recentf-auto-cleanup 'never))

;; ç¡®ä¿æ–‡ä»¶è¡¥å…¨å·¥ä½œ
(setq read-file-name-completion-ignore-case t
      read-buffer-completion-ignore-case t
      completion-ignore-case t)

;; å¯ç”¨éƒ¨åˆ†è¡¥å…¨
(setq completion-styles '(orderless)
      completion-category-defaults nil
      completion-category-overrides '((file (styles orderless))))

;; å¯ç”¨æ–‡ä»¶è¡¥å…¨ç¼“å­˜
(setq file-name-history-file (expand-file-name "file-name-history" user-emacs-directory))

(provide 'init-completion)
#+end_src

* ä¸»å…¥å£
#+begin_src emacs-lisp :tangle init.el
  ;; æ·»åŠ  lisp ç›®å½•åˆ° load-path
  (add-to-list 'load-path (expand-file-name "lisp" user-emacs-directory))

  ;; åŠ è½½å„ä¸ªæ¨¡å—
  (require 'init-basic)
  (require 'init-package)
  (require 'init-evil)
  (require 'init-ui)
  (require 'init-font)
  (require 'init-markdown)
  (require 'init-org)
  (require 'init-startup)
  (require 'init-dashboard)
  (require 'init-completion)
  (require 'init-theme)
  (require 'init-lang)      ;; æ·»åŠ è¯­è¨€é…ç½®

  ;; ç¡®ä¿å¿…è¦çš„åŒ…å·²å®‰è£…
  (use-package visual-fill-column :ensure t)
  
  ;; è§£å†³orgæ–‡ä»¶æœ¬åœ°å˜é‡å®‰å…¨æç¤ºé—®é¢˜
  ;; æ–¹æ³•1ï¼šä½¿ç”¨safe-local-eval-forms
  (add-to-list 'safe-local-eval-forms
               '(add-hook 'after-save-hook (lambda nil (org-babel-tangle)) nil t))

  ;; æ–¹æ³•2ï¼šå¤‡ç”¨æ–¹æ¡ˆ - ä½¿ç”¨safe-local-variable
  (put 'eval 'safe-local-variable
       (lambda (x)
         (and (functionp x)
              (string-match-p "org-babel-tangle" (prin1-to-string x)))))
#+end_src

* Local Variables
# Local Variables:
# eval: (add-hook 'after-save-hook (lambda () (org-babel-tangle)) nil t)
# End:
